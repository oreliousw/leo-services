# /etc/systemd/system/xmrig.service
[Unit]
Description=XMRig Miner (Mr O â€” Full CPU Build, HugePages enabled)
After=network-online.target p2pool.service
Wants=network-online.target
Requires=p2pool.service

[Service]
User=ubu
Group=ubu
WorkingDirectory=/opt/xmrig
LimitMEMLOCK=infinity
LimitMEMLOCKSoft=infinity

# Global 1Password session env (service token)
EnvironmentFile=/etc/op.env

# Launch via repo-tracked wrapper script (env -> exec xmrig)
ExecStart=/home/ubu/leo-services/scripts/start_xmrig.sh

# Restart + scheduling behavior
Restart=always
RestartSec=10
Nice=10
CPUWeight=90
IOSchedulingClass=idle

# Hardware / security capabilities
CapabilityBoundingSet=CAP_SYS_RAWIO
AmbientCapabilities=CAP_SYS_RAWIO

# Optional: reserve cores 0-1 for monerod
# CPUAffinity=2~

[Install]
WantedBy=multi-user.target
