[Unit]
Description=XMRig Miner (Mr O â€” Full CPU Build, HugePages enabled)
After=network-online.target p2pool.service
Wants=network-online.target
Requires=p2pool.service

[Service]
User=ubu
Group=ubu
WorkingDirectory=/opt/xmrig
# Global 1Password auth (service token)
EnvironmentFile=/etc/op.env
# Mining-specific secrets (wallet + Telegram mining bot)
ExecStart=/usr/bin/op run \
  --env-file=/opt/xmrig/env_mining.op.env \
  -- /opt/xmrig/xmrig -c /opt/xmrig/xmrig.json
Restart=always
RestartSec=10
Nice=10
CPUWeight=90
IOSchedulingClass=idle
CapabilityBoundingSet=CAP_SYS_RAWIO
AmbientCapabilities=CAP_SYS_RAWIO
# Optional: pin to all cores except 0-1 (reserved for monerod)
# CPUAffinity=2~

[Install]
WantedBy=multi-user.target
